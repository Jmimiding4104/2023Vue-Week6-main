import{_ as P,r as h,o as c,c as m,b as o,a as e,F as V,i as y,t as _,w as A,h as E,d as x,n as p}from"./index-BgkBJgaK.js";var i={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_API_NAME:"berlin",BASE_URL:"/vite-week6-airbnb/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const L={data(){return{carts:{},isLoading:!1,loadingStatus:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getCart(){this.isLoading=!0;const n=`${i.VITE_APP_API_URL}/api/${i.VITE_APP_API_NAME}/cart`;this.$http.get(n).then(s=>{this.carts=s.data.data}).catch(s=>{alert(s.response.data.message)}).finally(()=>{this.isLoading=!1})},removeCartItem(n){this.loadingStatus.loadingItem=n;const s=`${i.VITE_APP_API_URL}/api/${i.VITE_APP_API_NAME}/cart/${n}`;this.$http.delete(s).then(r=>{this.getCart()}).catch(r=>{alert(r.response.data.message)}).finally(()=>{this.loadingStatus.loadingItem=""})},createOrder(){if(!this.carts.carts.length){alert("購物車為空，無法送出訂單");return}this.isLoading=!0;const n=`${i.VITE_APP_API_URL}/api/${i.VITE_APP_API_NAME}/order`,s=this.form;this.$http.post(n,{data:s}).then(r=>{alert(r.data.message),this.$refs.form.resetForm(),this.getCart()}).catch(r=>{alert(r.response.data.message)}).finally(()=>{this.isLoading=!1})}},mounted(){this.getCart()}},k=e("h2",null,"前台購物車",-1),C={class:"row"},U={class:"col-6 mx-auto"},S={class:"table align-middle mb-5"},T=e("thead",null,[e("tr",null,[e("th",{scope:"col"}),e("th",{scope:"col"},"品名"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"單價")])],-1),w={scope:"row"},N=["onClick"],F={key:0,class:"spinner-border spinner-border-sm",role:"status"},M=e("span",{class:"visually-hidden"},"Loading...",-1),R=[M],q={class:"text-end"},B={key:1,class:"text-center"},D=e("td",{colspan:"4"},[e("p",{class:"my-3"},"購物車還沒有任何商品")],-1),O=[D],z=e("th",{scope:"row",colspan:"3",class:"text-end"},"總價",-1),j={class:"text-end"},G=e("h2",{class:"mb-3"},"收件資訊",-1),H={class:"mb-3"},J=e("label",{for:"email",class:"form-label"},"Email",-1),K={class:"mb-3"},Q=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),W={class:"mb-3"},X=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={class:"mb-3"},Z=e("label",{for:"address",class:"form-label"},"收件人地址",-1),$={class:"mb-3"},ee=e("label",{for:"message",class:"form-label"},"留言",-1),se=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary"},"送出訂單")],-1);function te(n,s,r,le,t,f){var b,g;const v=h("VueLoading"),d=h("VField"),u=h("ErrorMessage"),I=h("VForm");return c(),m(V,null,[k,o(v,{active:t.isLoading},null,8,["active"]),e("div",C,[e("div",U,[e("table",S,[T,e("tbody",null,[(g=(b=t.carts)==null?void 0:b.carts)!=null&&g.length?(c(!0),m(V,{key:0},y(t.carts.carts,l=>(c(),m("tr",{key:l.id},[e("th",w,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>f.removeCartItem(l.id)},[t.loadingStatus.loadingItem===l.id?(c(),m("div",F,R)):E("",!0),x(" 移除購物車 ")],8,N)]),e("td",null,_(l.product.title),1),e("td",null,_(l.qty)+" / "+_(l.product.unit),1),e("td",q,_(l.final_total),1)]))),128)):(c(),m("tr",B,O))]),e("tfoot",null,[e("tr",null,[z,e("td",j,_(t.carts.final_total),1)])])]),G,o(I,{ref:"form",class:"text-start",onSubmit:f.createOrder},{default:A(({errors:l})=>[e("div",H,[J,o(d,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入信箱",rules:"email|required",modelValue:t.form.user.email,"onUpdate:modelValue":s[0]||(s[0]=a=>t.form.user.email=a)},null,8,["class","modelValue"]),o(u,{name:"email",class:"invalid-feedback"})]),e("div",K,[Q,o(d,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":s[1]||(s[1]=a=>t.form.user.name=a)},null,8,["class","modelValue"]),o(u,{name:"姓名",class:"invalid-feedback"})]),e("div",W,[X,o(d,{id:"tel",name:"電話",type:"text",class:p(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:t.form.user.tel,"onUpdate:modelValue":s[2]||(s[2]=a=>t.form.user.tel=a)},null,8,["class","modelValue"]),o(u,{name:"電話",class:"invalid-feedback"})]),e("div",Y,[Z,o(d,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":s[3]||(s[3]=a=>t.form.user.address=a)},null,8,["class","modelValue"]),o(u,{name:"地址",class:"invalid-feedback"})]),e("div",$,[ee,o(d,{as:"textarea",id:"message",name:"message",type:"text",class:"form-control",placeholder:"請輸入留言",rows:"10",modelValue:t.form.message,"onUpdate:modelValue":s[4]||(s[4]=a=>t.form.message=a)},null,8,["modelValue"])]),se]),_:1},8,["onSubmit"])])])],64)}const ae=P(L,[["render",te]]);export{ae as default};
